<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Linux Store - Painel Financeiro</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />

    <style>
      * { margin: 0; padding: 0; box-sizing: border-box; font-family: "Segoe UI", sans-serif; }
      body { background-color: #0d1117; color: #ffffff; padding: 60px 20px 40px; } /* Aumentei o padding topo por causa da nav fixa */
      
      /* HEADER */
      h1 { text-align: center; font-size: 22px; margin-bottom: 30px; display: flex; align-items: center; justify-content: center; gap: 10px; flex-wrap: wrap; }
      h1 span { color: #2ecc71; }

      /* BOTÕES DE NAVEGAÇÃO TOPO */
      .nav-top { position: fixed; top: 0; left: 0; right: 0; z-index: 1000; display: flex; justify-content: flex-end; gap: 10px; padding: 10px 20px; background: rgba(13, 17, 23, 0.9); backdrop-filter: blur(5px); }
      .btn-admin-nav { background: #3498db !important; color: white !important; border: none; padding: 8px 12px; border-radius: 8px; text-decoration: none; font-weight: bold; display: flex; align-items: center; gap: 6px; font-size: 13px; }
      .btn-logout { background: #161b22; color: #8b949e; padding: 8px 12px; border: 1px solid #30363d; border-radius: 8px; text-decoration: none; font-weight: bold; display: flex; align-items: center; gap: 6px; font-size: 13px; }

      /* CARDS */
      .cards { display: grid; grid-template-columns: repeat(5, 1fr); gap: 15px; margin-bottom: 40px; max-width: 1200px; margin: 0 auto 40px auto; }
      .card { background: #161b22; padding: 15px; border-radius: 12px; border: 1px solid #30363d; }
      .card h3 { font-size: 10px; color: #8b949e; text-transform: uppercase; margin-bottom: 8px; display: flex; align-items: center; gap: 5px; }
      .card p { font-size: 18px; font-weight: bold; color: #2ecc71; }

      /* FORMS */
      .forms-container { display: grid; grid-template-columns: 1fr 1.5fr; gap: 20px; max-width: 1200px; margin: 0 auto 40px auto; }
      .form-box { background: #161b22; padding: 20px; border-radius: 12px; border: 1px solid #30363d; }
      .form-box h2 { font-size: 15px; margin-bottom: 15px; display: flex; align-items: center; gap: 8px; }
      input { width: 100%; padding: 12px; background: #0d1117; border: 1px solid #30363d; border-radius: 8px; color: white; margin-bottom: 10px; font-size: 16px; }
      .btn-main { width: 100%; padding: 12px; border-radius: 8px; border: none; cursor: pointer; font-weight: bold; background: #2ecc71; color: #0d1117; transition: 0.3s; }

      /* TABELA */
      .table-container { max-width: 1200px; margin: 0 auto; background: #161b22; border-radius: 12px; border: 1px solid #30363d; overflow-x: auto; } /* overflow-x permite scroll no mobile */
      .tabela { width: 100%; border-collapse: collapse; min-width: 600px; } /* Garante que a tabela não esmague no mobile */
      .tabela th { text-align: left; padding: 12px; background: #1f242c; color: #8b949e; font-size: 13px; }
      .tabela td { padding: 12px; border-top: 1px solid #30363d; color: #c9d1d9; font-size: 14px; }
      .status-pago { color: #2ecc71; font-weight: bold; }
      .status-receber { color: #f9a825; font-weight: bold; }

      /* --- MEDIA QUERIES (A MÁGICA DO MOBILE) --- */
      
      @media (max-width: 992px) {
        .cards { grid-template-columns: repeat(3, 1fr); }
        .forms-container { grid-template-columns: 1fr; }
      }

      @media (max-width: 600px) {
        body { padding: 70px 10px 20px; }
        .cards { grid-template-columns: repeat(2, 1fr); gap: 10px; }
        .card:last-child { grid-column: span 2; } /* Card de lucro ocupa a linha toda */
        
        .nav-top { justify-content: center; width: 100%; }
        h1 { font-size: 18px; }

        .form-box { padding: 15px; }
        .form-row-mobile { flex-direction: column; gap: 0 !important; }
      }
    </style>
  </head>
  <body>

    <div class="nav-top">
      {% if is_admin %}
      <a href="/registrar" class="btn-admin-nav">
        <i class="fa-solid fa-user-plus"></i> <span class="txt-nav">Novo Usuário</span>
      </a>
      {% endif %}
      <a href="/logout" class="btn-logout">
        <i class="fa-solid fa-right-from-bracket"></i> <span class="txt-nav">Sair</span>
      </a>
    </div>

    <h1>
      <i class="fa-solid fa-desktop"></i> Painel Financeiro – <span>Linux Store</span>
    </h1>

    <div class="cards">
      <div class="card">
        <h3><i class="fa-solid fa-users"></i> Clientes</h3>
        <p>{{ clientes|length }}</p>
      </div>
      <div class="card">
        <h3><i class="fa-solid fa-arrow-trend-up"></i> Recebido</h3>
        <p id="cRecebido">R$ 0,00</p>
      </div>
      <div class="card">
        <h3><i class="fa-solid fa-dollar-sign"></i> A receber</h3>
        <p id="cReceber">R$ 0,00</p>
      </div>
      <div class="card">
        <h3><i class="fa-solid fa-box"></i> Custos</h3>
        <p id="cCusto">R$ 0,00</p>
      </div>
      <div class="card">
        <h3><i class="fa-solid fa-chart-line"></i> Lucro</h3>
        <p id="cLucro">R$ 0,00</p>
      </div>
    </div>

    <div class="forms-container">
      <div class="form-box">
        <h2><i class="fa-solid fa-gears"></i> Custo por Ativo</h2>
        <form action="/salvar_ativo" method="post">
            <input type="number" step="0.01" name="valor" value="{{ user_valor_ativo }}" placeholder="Ex: 10" required />
            <button type="submit" class="btn-main">Salvar Custo</button>
        </form>
      </div>

      <div class="form-box">
        <h2><i class="fa-solid fa-user-plus"></i> Novo Cliente</h2>
        <form action="/adicionar_cliente" method="post">
            <div style="display: flex; gap: 10px;" class="form-row-mobile">
                <input name="nome" placeholder="Nome" required />
                <input name="usuario" placeholder="Usuário" required />
                <input name="valor" type="number" step="0.01" placeholder="R$" required />
            </div>
            <button type="submit" class="btn-main">Cadastrar Cliente</button>
        </form>
      </div>
    </div>

    <div class="table-container">
      <table class="tabela">
        <thead>
          <tr>
            <th>Nome</th>
            <th>Usuário</th>
            <th>Valor</th>
            <th>Status</th>
            <th>Ações</th>
          </tr>
        </thead>
        <tbody>
          {% for cliente in clientes %}
          <tr>
            <td>{{ cliente.nome }}</td>
            <td>{{ cliente.usuario }}</td>
            <td class="col-valor">R$ {{ "%.2f"|format(cliente.valor) }}</td>
            <td class="col-status {{ 'status-pago' if cliente.status == 'pago' else 'status-receber' }}">
                {{ 'Pago' if cliente.status == 'pago' else 'A receber' }}
            </td>
            <td>
              <div style="display: flex; gap: 20px;">
                <a href="/status/{{ cliente.id }}" style="text-decoration: none; color: #2ecc71; font-size: 18px;"><i class="fa-solid fa-check"></i></a>
                <a href="/deletar/{{ cliente.id }}" style="text-decoration: none; color: #e74c3c; font-size: 18px;"><i class="fa-solid fa-trash"></i></a>
              </div>
            </td>
          </tr>
          {% else %}
          <tr>
            <td colspan="5" style="text-align: center; padding: 30px; color: #8b949e;">Nenhum dado encontrado.</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <script>
      window.onload = function() {
          let recebido = 0;
          let receber = 0;
          const custoPorCliente = Number("{{ user_valor_ativo or 0 }}");

          document.querySelectorAll('tbody tr').forEach(tr => {
              const valorTxt = tr.querySelector('.col-valor')?.innerText.replace('R$ ', '').trim();
              const statusTxt = tr.querySelector('.col-status')?.innerText.trim();

              if (valorTxt) {
                  const v = parseFloat(valorTxt.replace(',', '.'));
                  if (statusTxt === 'Pago') recebido += v;
                  else receber += v;
              }
          });

          const custoTotal = custoPorCliente * Number("{{ clientes|length }}");
          const lucro = recebido - custoTotal;

          document.getElementById('cRecebido').innerText = "R$ " + recebido.toFixed(2);
          document.getElementById('cReceber').innerText = "R$ " + receber.toFixed(2);
          document.getElementById('cCusto').innerText = "R$ " + custoTotal.toFixed(2);
          document.getElementById('cLucro').innerText = "R$ " + lucro.toFixed(2);

          if (lucro < 0) document.getElementById('cLucro').style.color = "#e74c3c";
      };
    </script>
  </body>
</html>